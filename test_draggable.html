<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<meta charset="utf-8" />
	
	<!-- Make IE recognise HTML5 elements (for styling - must stay in the head, before elements are used) -->
	<!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
	<title>Drag test</title>
	
	<style type="text/css">
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
		
		body {
			padding-left:  1.6667em;
			padding-right: 1.6667em;
			font-family: Helvetica, Arial, sans-serif;
		}
		
		.test {
			position: absolute;
			background-color: red;
			width:  360px;
			height: 100px;
			padding: 20px;
		  left: 1.6667em;
		  
		  color: white;
		  text-decoration: none;
		}
		
		.first_test {
			top: 200px;
		}
		
		.second_test {
			top: 360px;
		}
		
		.third_test {
			top: 520px;
		}
	</style>

</head>

<body>
	<header>
		<h1>Drag test</h1>
		<p>What happens when we drag a draggable node, when no move handlers have been bound?</p>
		<p>What happens if it is removed from the DOM while dragging?</p>
		<p>What happens if a node is draggable AND has move events bound?</p>
	</header>
	
	<a href="#" class="first_test test" draggable="true">Draggable node.</a>
	<a href="#" class="second_test test" draggable="true">Draggable node that gets removed on dragend.</a>
	<a href="#" class="third_test test" draggable="true">
		Draggable node that also has move bound.<br/><br/>
		Should not be draggable because move events take precedence.
	</a>
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
	<script src="js/jquery.event.move.js"></script>
	<script type="text/javascript">
    var doc = jQuery(document);
    
    function logEvent(e){ console.log(e.type, e); }
    
    function dropEffectNone(e) {
      e.originalEvent.dataTransfer.dropEffect = 'none';
    }
    
    function cancelDrag(elem) {
      // Bind drag cancellers.
      doc.bind('dragenter dragover', dropEffectNone);
      
      // But remove the elem and the drag cancellers when the
      // user releases the elem.
      elem.bind('dragend', function() {
        doc
        .unbind('dragenter', dropEffectNone)
        .unbind('dragover', dropEffectNone);
        
        console.log('Remove elem from DOM.');
        elem.remove();
      });
    }
    
    doc.ready(function(){
      jQuery('.test').bind('dragstart', function(e) {
        // Data must be set to make the node draggable in FF.
        e.originalEvent.dataTransfer.setData("application/json", "Drag text");
      });
      
      // The second test node's drag is cancelled, and it is
      // removed from the DOM on dragend.
      jQuery('.second_test').bind('dragstart', function(e) {  
        var elem = jQuery(e.target);
        
      	cancelDrag(elem);
      });
      
      jQuery('.third_test').bind('movestart move moveend', logEvent);
    });
	</script>
</body>
</html>